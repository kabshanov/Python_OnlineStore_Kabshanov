# Проект: Сайт интернет-магазина (Django + Docker)

**Автор:** Михаил Кабшанов
**GitHub:** kabshanov
**Telegram:** @kabmik

-----

## Оглавление

- [1. Описание проекта](#1-описание-проекта)
- [2. Возможности](#2-возможности)
- [3. Стек технологий](#3-стек-технологий)
- [4. Архитектура](#4-архитектура)
- [5. Запуск проекта (Docker)](#5-запуск-проекта-docker)
  - [Требования](#требования)
  - [Шаг 1: Конфигурация](#шаг-1-конфигурация)
  - [Шаг 2: Сборка и запуск](#шаг-2-сборка-и-запуск)
  - [Шаг 3: Создание суперпользователя](#шаг-3-создание-суперпользователя)
  - [Управление контейнерами](#управление-контейнерами)
- [6. Management-команды](#6-management-команды)
- [7. Тесты](#7-тесты)

-----

## 1\. Описание проекта

Этот проект представляет собой полнофункциональный backend для интернет-магазина, разработанный на фреймворке **Django**. Приложение полностью контейнеризовано с использованием **Docker** и **Docker Compose**, что обеспечивает легкий запуск и масштабируемость.

Проект включает в себя весь основной цикл электронной коммерции: от просмотра каталога и добавления товаров в корзину до оформления заказа с контролем остатков на складе и личным кабинетом пользователя.

-----

## 2\. Возможности

  - **Каталог товаров:** Отображение списка товаров и детальных карточек товаров.
  - **Система пользователей:** Полная аутентификация (регистрация, вход, выход).
  - **Личный кабинет:** Пользователь может просматривать свою историю заказов и их статусы.
  - **Корзина:** Добавление товаров в корзину с выбором количества.
  - **Система заказов:** Оформление заказа с автоматическим списанием товаров со склада.
  - **Контроль остатков:** Встроенная проверка, не позволяющая заказать товара больше, чем есть на складе.
  - **Админ-панель:** Расширенная админ-панель Django (на русском языке) для управления товарами, категориями, заказами, пользователями и остатками.
  - **Импорт/Экспорт:** Кастомные management-команды для массовой загрузки товаров из JSON и выгрузки остатков.

-----

## 3\. Стек технологий

  - **Backend:** Python 3.11, Django 5.2
  - **База данных:** PostgreSQL
  - **Контейнеризация:** Docker, Docker Compose
  - **Библиотеки:** `psycopg2-binary`, `django-admin-interface`

-----

## 4\. Архитектура

Проект следует простой и надежной двухкомпонентной архитектуре, управляемой `docker-compose.yml`:

1.  **`db` (База данных):**

      * Контейнер, запускающий `postgres:14-alpine`.
      * Хранит все данные приложения (пользователей, товары, заказы).
      * Данные сохраняются в Docker-volume `db-data`, чтобы не теряться при перезапуске.

2.  **`web` (Веб-приложение):**

      * Контейнер, собираемый из `Dockerfile` (на базе `python:3.11-slim`).
      * Содержит Django-приложение.
      * При старте автоматически применяет миграции (`sleep 5 && python manage.py migrate`).
      * Запускает `runserver` и открывает порт `8000`.
      * Подключается к контейнеру `db` по его имени службы (`HOST=db`).

-----

## 5\. Запуск проекта (Docker)

### Требования

  - [Docker](https://www.docker.com/products/docker-desktop/)
  - [Docker Compose](https://docs.docker.com/compose/) (обычно устанавливается вместе с Docker Desktop)

### Шаг 1: Конфигурация

Все основные настройки находятся в файле `docker-compose.yml`. Перед первым запуском вы можете изменить переменные окружения для сервисов `db` и `web`:

  - `POSTGRES_DB`: Название базы данных (по умолч. `online_store_db`)
  - `POSTGRES_USER`: Имя пользователя БД (по умолч. `store_admin`)
  - `POSTGRES_PASSWORD`: Пароль пользователя БД (по умолч. `ваш_супер_надежный_пароль`)

**Важно:** Пароль в `docker-compose.yml` и в `online_store_project/settings.py` (для `os.environ.get`) должен совпадать.

### Шаг 2: Сборка и запуск

Находясь в корневой папке проекта (где лежит `docker-compose.yml`), выполните:

```bash
docker-compose up --build
```

Эта команда соберет `Dockerfile`, скачает образ Postgres и запустит оба контейнера. Сайт будет доступен по адресу:
[http://localhost:8000/](https://www.google.com/search?q=http://localhost:8000/)

### Шаг 3: Создание суперпользователя

Для доступа к админ-панели (`/admin/`) необходимо создать суперпользователя.

1.  Откройте **второй** терминал (не закрывая тот, где запущен `docker-compose up`).

2.  Выполните команду:

    ```bash
    docker-compose exec web python manage.py createsuperuser
    ```

3.  Следуйте инструкциям в терминале, чтобы задать логин, email и пароль.

### Управление контейнерами

  - **Остановить** приложение (и удалить контейнеры):
    ```bash
    docker-compose down
    ```
  - **Остановить** (с сохранением данных в `db-data`):
    *Нажмите `Ctrl+C` в терминале, где запущен `docker-compose up`.*
  - **Запустить** (без пересборки):
    ```bash
    docker-compose up
    ```

-----

## 6\. Management-команды

В проект встроены кастомные команды для управления данными. Выполняются через `docker-compose exec`.

### Экспорт остатков

Выгружает текущие остатки всех товаров в файл `stock_report.json`.

```bash
docker-compose exec web python manage.py export_product_residue > stock_report.json
```

### Импорт товаров

Загружает товары из JSON-файла в базу данных. (Пример файла `data.json` см. в `store/management/commands/load_goods.py`).

```bash
# data.json должен лежать в корне проекта
docker-compose exec web python manage.py load_goods data.json
```

-----

## 7\. Тесты

Проект покрыт тестами для моделей, форм и представлений. Тесты запускаются в отдельной, временной базе данных.

Для запуска тестов выполните:

```bash
docker-compose exec web python manage.py test
```